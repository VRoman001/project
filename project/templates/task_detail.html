{% extends "base.html" %}
{% block content %}
<h1>{{ task.title }}</h1>

<div class="card">
    <div class="card-body">
        <div class="mb-4">{{ task.description|safe }}</div>

<form method="post">
    <div class="code-editor">
        <div class="line-numbers"></div>
        <textarea name="code" class="code-input" rows="14"
                  style="font-family: 'Courier New', monospace; font-size: 16px;">{{ code }}</textarea>
    </div>
    <button type="submit" class="btn-primary btn-lg mt-2">Перевірити код</button>
</form>


        {% if result %}
        <div class="mt-5 p-4 rounded text-center text-white fs-4
                    {{ 'bg-success' if 'Відмінно' in result else 'bg-danger' }}">
            <strong>{{ result }}</strong>
            {% if errors %}
            <ul class="mt-3 text-start">
                {% for e in errors %}
                <li>{{ e }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<a href="/tasks" class="btn mt-4">Назад до завдань</a>

<!-- КОНФЕТІ ПРИ УСПІШНОМУ ПРОХОДЖЕННІ -->
{% if result and 'Відмінно' in result %}
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
const textarea = document.querySelector('.code-input');
const lineNumbers = document.querySelector('.line-numbers');

function updateLineNumbers() {
    const lines = textarea.value.split('\n').length;
    lineNumbers.innerHTML = '';
    for (let i = 1; i <= lines; i++) {
        const div = document.createElement('div');
        div.textContent = i;
        lineNumbers.appendChild(div);
    }
}

// оновлюємо під час вводу та на старті
textarea.addEventListener('input', updateLineNumbers);
window.addEventListener('load', updateLineNumbers);
</script>

{% endif %}

{% endblock %}